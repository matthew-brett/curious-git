<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>How do git submodules work? &mdash; Curious git</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="Curious git" href="index.html" />
    <link rel="next" title="An algorithm for git push" href="git_push_algorithm.html" />
    <link rel="prev" title="Types of git objects" href="git_object_types.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          Curious git</a>
        <span class="navbar-text navbar-version pull-left"><b>0.2</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="curious_remotes.html">git remotes - working with other people, making backups</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_object_types.html">Types of git objects</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">How do git submodules work?</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_push_algorithm.html">An algorithm for git push</a></li>
<li class="toctree-l1"><a class="reference internal" href="reading_git_objects.html">Reading git objects</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="curious_git.html">The curious coder&#8217;s guide to git</a></li>
<li class="toctree-l1"><a class="reference internal" href="README.html">Curious git</a></li>
<li class="toctree-l1"><a class="reference internal" href="np-versions/README.html">np-versions</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">How do git submodules work?</a><ul>
<li><a class="reference internal" href="#why-submodules">Why submodules?</a></li>
<li><a class="reference internal" href="#worked-example">Worked example</a><ul>
<li><a class="reference internal" href="#myproject"><code class="docutils literal"><span class="pre">myproject</span></code></a></li>
<li><a class="reference internal" href="#super"><code class="docutils literal"><span class="pre">super</span></code></a></li>
<li><a class="reference internal" href="#adding-myproject-as-a-submodule-of-super">Adding <code class="docutils literal"><span class="pre">myproject</span></code> as a submodule of <code class="docutils literal"><span class="pre">super</span></code></a></li>
<li><a class="reference internal" href="#storing-the-current-commit-of-myproject">Storing the current commit of <code class="docutils literal"><span class="pre">myproject</span></code></a></li>
<li><a class="reference internal" href="#updating-submodules-from-their-source-repositories">Updating submodules from their source repositories</a></li>
<li><a class="reference internal" href="#cloning-a-repository-with-submodules">Cloning a repository with submodules</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="git_object_types.html" title="Previous Chapter: Types of git objects"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Types of git ...</span>
    </a>
  </li>
  <li>
    <a href="git_push_algorithm.html" title="Next Chapter: An algorithm for git push"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">An algorithm ... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/git_submodules.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="how-do-git-submodules-work">
<h1>How do git submodules work?<a class="headerlink" href="#how-do-git-submodules-work" title="Permalink to this headline">¶</a></h1>
<p>Git submodules can be a little confusing.</p>
<p>This page explains how git <em>stores</em> submodules.  My hope is that this will make
it easier to understand how to <em>use</em> submodules.</p>
<p>If you&#8217;ve read <a class="reference internal" href="curious_git.html"><em>The curious coder&#8217;s guide to git</em></a> you will recognize this way of thinking.</p>
<div class="section" id="why-submodules">
<h2>Why submodules?<a class="headerlink" href="#why-submodules" title="Permalink to this headline">¶</a></h2>
<p>Submodules are useful when you have a project that is under git version
control, and you need files from another project that is also under git
version control.</p>
</div>
<div class="section" id="worked-example">
<h2>Worked example<a class="headerlink" href="#worked-example" title="Permalink to this headline">¶</a></h2>
<p>We will call the project that we need to use just <em>myproject</em>, and the project
that is using <em>myproject</em> we will call <em>super</em>.</p>
<p>We are expecting that &#8220;myproject&#8221; will continue to develop.</p>
<p>&#8220;Super&#8221; is going to start using some version of &#8220;myproject&#8221;.  In the spirit of
version control, we want to keep track of exactly which &#8220;myproject&#8221; version
&#8220;super&#8221; is using.</p>
<div class="section" id="myproject">
<h3><code class="docutils literal"><span class="pre">myproject</span></code><a class="headerlink" href="#myproject" title="Permalink to this headline">¶</a></h3>
<p>We make a little &#8220;myproject&#8221; to start:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ mkdir myproject
$ <span class="nb">cd</span> myproject
$ git init
Initialized empty Git repository in /Users/mb312/dev_trees/curious-git/working/myproject/.git/
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">echo</span> <span class="s2">&quot;Important code and data&quot;</span> &gt; some_data.txt
$ git add some_data.txt
$ git commit -m <span class="s2">&quot;Initial commit on myproject&quot;</span>
<span class="o">[</span>master <span class="o">(</span>root-commit<span class="o">)</span> 196bbbb<span class="o">]</span> Initial commit on myproject
 <span class="m">1</span> file changed, <span class="m">1</span> insertion<span class="o">(</span>+<span class="o">)</span>
 create mode <span class="m">100644</span> some_data.txt
</pre></div>
</div>
<p>Back to the working directory containing the repositories:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ..
</pre></div>
</div>
</div>
<div class="section" id="super">
<h3><code class="docutils literal"><span class="pre">super</span></code><a class="headerlink" href="#super" title="Permalink to this headline">¶</a></h3>
<p>Now a &#8220;super&#8221; project:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ mkdir super
$ <span class="nb">cd</span> super
</pre></div>
</div>
<p>Remember (from <a class="reference internal" href="curious_git.html"><em>The curious coder&#8217;s guide to git</em></a>) that doing <code class="docutils literal"><span class="pre">git</span> <span class="pre">add</span></code> on a file adds a new
copy of that file to the <code class="docutils literal"><span class="pre">.git/objects</span></code> directory.  So, <code class="docutils literal"><span class="pre">.git/objects</span></code>
starts off empty:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git init
Initialized empty Git repository in /Users/mb312/dev_trees/curious-git/working/super/.git/
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ tree -a .git/objects
.git/objects
├── info
└── pack

<span class="m">2</span> directories, <span class="m">0</span> files
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ 
</pre></div>
</div>
<p>When we <code class="docutils literal"><span class="pre">git</span> <span class="pre">add</span></code> a file, there is one new file in <code class="docutils literal"><span class="pre">.git/objects</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">echo</span> <span class="s2">&quot;This project will use ``myproject``&quot;</span> &gt; README.txt
$ git add README.txt
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ tree -a .git/objects
.git/objects
├── 9c
│   └── 0042144fc489d7b528ef186af49e78c2867f91
├── info
└── pack

<span class="m">3</span> directories, <span class="m">1</span> file
</pre></div>
</div>
<p>Now do the first commit for &#8220;super&#8221;:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git commit -m <span class="s2">&quot;Initial commit on super&quot;</span>
<span class="o">[</span>master <span class="o">(</span>root-commit<span class="o">)</span> 2326240<span class="o">]</span> Initial commit on super
 <span class="m">1</span> file changed, <span class="m">1</span> insertion<span class="o">(</span>+<span class="o">)</span>
 create mode <span class="m">100644</span> README.txt
</pre></div>
</div>
<p>The commit made two new objects in the <code class="docutils literal"><span class="pre">.git/objects</span></code> directory:</p>
<ul class="simple">
<li>a <em>tree</em> object giving the directory listing of the root directory;</li>
<li>a <em>commit</em> object giving information about the commit itself.</li>
</ul>
<p>So, we now have three files in <code class="docutils literal"><span class="pre">.git/objects</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ tree -a .git/objects
.git/objects
├── 23
│   └── 262403a0b913d02219ead935dd1a85d3724a0d
├── 9c
│   └── 0042144fc489d7b528ef186af49e78c2867f91
├── f1
│   └── 3a8c8331c76ac965c43b09d11ee2d72bb053c1
├── info
└── pack

<span class="m">5</span> directories, <span class="m">3</span> files
</pre></div>
</div>
</div>
<div class="section" id="adding-myproject-as-a-submodule-of-super">
<h3>Adding <code class="docutils literal"><span class="pre">myproject</span></code> as a submodule of <code class="docutils literal"><span class="pre">super</span></code><a class="headerlink" href="#adding-myproject-as-a-submodule-of-super" title="Permalink to this headline">¶</a></h3>
<p>We use a git submodule to put &#8220;myproject&#8221; inside &#8220;super&#8221;.  We will use the
name &#8220;subproject&#8221; for the submodule copy of &#8220;myproject&#8221;, to make clear that it
is the submodule copy:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git submodule add ../myproject subproject
Cloning into <span class="s1">&#39;subproject&#39;</span>...
<span class="k">done</span>.
</pre></div>
</div>
<p>What just happened?:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git status
On branch master
Changes to be committed:
  <span class="o">(</span>use <span class="s2">&quot;git reset HEAD &lt;file&gt;...&quot;</span> to unstage<span class="o">)</span>

	new file:   .gitmodules
	new file:   subproject
</pre></div>
</div>
<p>Notice that <code class="docutils literal"><span class="pre">git</span> <span class="pre">submodule</span></code> has already staged its changes, so we need the
<code class="docutils literal"><span class="pre">--staged</span></code> flag to <code class="docutils literal"><span class="pre">git</span> <span class="pre">diff</span></code> to see what has changed:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git diff --staged
diff --git a/.gitmodules b/.gitmodules
new file mode 100644
index 0000000..00b54ec
--- /dev/null
+++ b/.gitmodules
@@ -0,0 +1,3 @@
+<span class="o">[</span>submodule <span class="s2">&quot;subproject&quot;</span><span class="o">]</span>
+	<span class="nv">path</span> <span class="o">=</span> subproject
+	<span class="nv">url</span> <span class="o">=</span> ../myproject
diff --git a/subproject b/subproject
new file mode 160000
index 0000000..196bbbb
--- /dev/null
+++ b/subproject
@@ -0,0 +1 @@
+Subproject commit 196bbbb2b7497fdc868fa61425959d23ff1c0fe5
</pre></div>
</div>
<p>As you saw, the output from <code class="docutils literal"><span class="pre">git</span> <span class="pre">submodule</span></code> says <code class="docutils literal"><span class="pre">Cloning</span> <span class="pre">into</span>
<span class="pre">subproject</span></code>, and sure enough, if we look in the new <code class="docutils literal"><span class="pre">subproject</span></code> directory,
there is a clone of &#8220;myproject&#8221; there:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ tree -a subproject
subproject
├── .git
└── some_data.txt

<span class="m">0</span> directories, <span class="m">2</span> files
</pre></div>
</div>
<p>So, <code class="docutils literal"><span class="pre">git</span> <span class="pre">submodule</span></code> has:</p>
<ol class="arabic simple">
<li>cloned &#8220;myproject&#8221; to &#8220;super&#8221; subdirectory &#8220;subproject&#8221;;</li>
<li>created and staged a small text file called <code class="docutils literal"><span class="pre">.gitmodules</span></code> that records
the relationship of the <code class="docutils literal"><span class="pre">subproject</span></code> subdirectory to the original
&#8220;myproject&#8221; repository;</li>
<li>claimed to have made a new <em>file</em> in the &#8220;super&#8221; repository that records
the &#8220;myproject&#8221; commit that the submodule contains.</li>
</ol>
<p>It&#8217;s the last of these three that is a little strange, so we will explore.</p>
</div>
<div class="section" id="storing-the-current-commit-of-myproject">
<h3>Storing the current commit of <code class="docutils literal"><span class="pre">myproject</span></code><a class="headerlink" href="#storing-the-current-commit-of-myproject" title="Permalink to this headline">¶</a></h3>
<p>Why do I say that git &#8220;claimed&#8221; to have made a new file to record the
&#8220;myproject&#8221; commit?</p>
<p>Remember that we had three files in the <code class="docutils literal"><span class="pre">.git/objects</span></code> directory of &#8220;super&#8221;
after the first commit.  After <code class="docutils literal"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">add</span></code> we have four:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ tree -a .git/objects
.git/objects
├── 00
│   └── b54ece7789a75ca80a0edb1e1b1e532a1833d8
├── 23
│   └── 262403a0b913d02219ead935dd1a85d3724a0d
├── 9c
│   └── 0042144fc489d7b528ef186af49e78c2867f91
├── f1
│   └── 3a8c8331c76ac965c43b09d11ee2d72bb053c1
├── info
└── pack

<span class="m">6</span> directories, <span class="m">4</span> files
</pre></div>
</div>
<p>The new object has hash <code class="docutils literal"><span class="pre">00b54ece7789a75ca80a0edb1e1b1e532a1833d8</span></code>, and it contains the contents of
the new <code class="docutils literal"><span class="pre">.gitmodules</span></code> file:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git cat-file -p 00b54ece7789a75ca80a0edb1e1b1e532a1833d8
<span class="o">[</span>submodule <span class="s2">&quot;subproject&quot;</span><span class="o">]</span>
	<span class="nv">path</span> <span class="o">=</span> subproject
	<span class="nv">url</span> <span class="o">=</span> ../myproject
</pre></div>
</div>
<p>If there is only one new object in <code class="docutils literal"><span class="pre">.git/objects</span></code>, and that is for
<code class="docutils literal"><span class="pre">.gitmodules</span></code>, then there is no new git object corresponding to the
&#8220;myproject&#8221; repository.  What has in fact happened, is that git records the
commit for &#8220;myproject&#8221; in the directory listing, instead of recording the
<code class="docutils literal"><span class="pre">subproject</span></code> directory as a subdirectory (tree object) or a file (blob
object).  That is a bit difficult to see at the moment, because the directory
listing is in the git staging area and not yet written into a tree object.  To
write the tree object, we do a commit:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git commit -m <span class="s2">&quot;Adding the submodule&quot;</span>
<span class="o">[</span>master 7c556d2<span class="o">]</span> Adding the submodule
 <span class="m">2</span> files changed, <span class="m">4</span> insertions<span class="o">(</span>+<span class="o">)</span>
 create mode <span class="m">100644</span> .gitmodules
 create mode <span class="m">160000</span> subproject
</pre></div>
</div>
<p>The exotic <code class="docutils literal"><span class="pre">git</span> <span class="pre">ls-tree</span></code> command shows us the contents of the new root tree
object (directory listing) for this commit:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git ls-tree master
<span class="m">100644</span> blob 00b54ece7789a75ca80a0edb1e1b1e532a1833d8	.gitmodules
<span class="m">100644</span> blob 9c0042144fc489d7b528ef186af49e78c2867f91	README.txt
<span class="m">160000</span> commit 196bbbb2b7497fdc868fa61425959d23ff1c0fe5	subproject
</pre></div>
</div>
<p>As you can see, the two real files – <code class="docutils literal"><span class="pre">.gitmodules</span></code> and <code class="docutils literal"><span class="pre">README.txt</span></code>
– are listed as type <code class="docutils literal"><span class="pre">blob</span></code>, with the hashes of their file contents. This
is the usual way git refers to a file in a directory listing (see
<a class="reference internal" href="curious_git.html"><em>The curious coder&#8217;s guide to git</em></a>, and <a class="reference internal" href="git_object_types.html#git-object-types"><span>Types of git objects</span></a>). The new entry for
<code class="docutils literal"><span class="pre">subproject</span></code> is of type <code class="docutils literal"><span class="pre">commit</span></code>.  The hash is the hash for current commit
of the &#8220;myproject&#8221; repository, in the <code class="docutils literal"><span class="pre">subproject</span></code> copy:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> subproject
$ git log
commit 196bbbb2b7497fdc868fa61425959d23ff1c0fe5
Author: Matthew Brett &lt;matthew.brett@gmail.com&gt;
Date:   Tue May <span class="m">1</span> 11:13:13 <span class="m">2012</span> +0100

    Initial commit on myproject
</pre></div>
</div>
</div>
<div class="section" id="updating-submodules-from-their-source-repositories">
<h3>Updating submodules from their source repositories<a class="headerlink" href="#updating-submodules-from-their-source-repositories" title="Permalink to this headline">¶</a></h3>
<p>How do we keep the <code class="docutils literal"><span class="pre">subproject</span></code> copy of &#8220;myproject&#8221; up to date with the
original <code class="docutils literal"><span class="pre">myproject</span></code> repository?</p>
<p>We go back to the original &#8220;myproject&#8221; repository and make another commit:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ../myproject
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="c1"># Now in the original &quot;myproject&quot; directory</span>
$ <span class="nb">echo</span> <span class="s2">&quot;More data&quot;</span> &gt; some_more_data.txt
$ git add some_more_data.txt
$ git commit -m <span class="s2">&quot;Add some more data&quot;</span>
<span class="o">[</span>master 43c26bf<span class="o">]</span> Add some more data
 <span class="m">1</span> file changed, <span class="m">1</span> insertion<span class="o">(</span>+<span class="o">)</span>
 create mode <span class="m">100644</span> some_more_data.txt
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git branch -v
* master 43c26bf Add some more data
</pre></div>
</div>
<p>Of course &#8220;super&#8221; has not changed, because we haven&#8217;t updated the submodule
clone:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ../super
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git status
On branch master
nothing to commit, working directory clean
</pre></div>
</div>
<p>The &#8220;subproject&#8221; directory is a full git repository clone of the original
&#8220;myproject&#8221;.  Remember that <code class="docutils literal"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">add</span></code> created the directory by
cloning. The &#8220;myproject&#8221; clone has a remote from the URL we gave to <code class="docutils literal"><span class="pre">git</span>
<span class="pre">submodule</span> <span class="pre">add</span></code>.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="c1"># We&#39;re in the &quot;super&quot; directory</span>
$ <span class="nb">cd</span> subproject
$ <span class="c1"># Now we&#39;re in the submodule clone of &quot;myproject&quot;</span>
$ git remote -v
origin	/Users/mb312/dev_trees/curious-git/working/myproject <span class="o">(</span>fetch<span class="o">)</span>
origin	/Users/mb312/dev_trees/curious-git/working/myproject <span class="o">(</span>push<span class="o">)</span>
</pre></div>
</div>
<p>We can do a <code class="docutils literal"><span class="pre">fetch</span></code> / <code class="docutils literal"><span class="pre">merge</span></code> to get the new commit:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="c1"># This is the same as &quot;git pull&quot;</span>
$ git fetch origin
$ git merge origin/master
Updating 196bbbb..43c26bf
Fast-forward
 some_more_data.txt <span class="p">|</span> <span class="m">1</span> +
 <span class="m">1</span> file changed, <span class="m">1</span> insertion<span class="o">(</span>+<span class="o">)</span>
 create mode <span class="m">100644</span> some_more_data.txt
From /Users/mb312/dev_trees/curious-git/working/myproject
   196bbbb..43c26bf  master     -&gt; origin/master
</pre></div>
</div>
<p>Now what do we see in &#8220;super&#8221;?</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ..
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="c1"># Now we are in the &quot;super&quot; directory</span>
$ git status
On branch master
Changes not staged <span class="k">for</span> commit:
  <span class="o">(</span>use <span class="s2">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed<span class="o">)</span>
  <span class="o">(</span>use <span class="s2">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes in working directory<span class="o">)</span>

	modified:   subproject <span class="o">(</span>new commits<span class="o">)</span>

no changes added to commit <span class="o">(</span>use <span class="s2">&quot;git add&quot;</span> and/or <span class="s2">&quot;git commit -a&quot;</span><span class="o">)</span>
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git diff
diff --git a/subproject b/subproject
index 196bbbb..43c26bf 160000
--- a/subproject
+++ b/subproject
@@ -1 +1 @@
-Subproject commit 196bbbb2b7497fdc868fa61425959d23ff1c0fe5
+Subproject commit 43c26bf6df6a4efade8082f3a5473b807d07c161
</pre></div>
</div>
<p>Git is not tracking the <em>contents</em> of the &#8220;subproject&#8221; directory, but the <em>git
state</em> of the directory.  In this case, all &#8220;super&#8221; sees is that the commit
has changed.</p>
<p>As when we added the submodule, a <code class="docutils literal"><span class="pre">git</span> <span class="pre">add</span></code> of the <code class="docutils literal"><span class="pre">subproject</span></code> directory,
has the effect of updating the commit that the &#8220;super&#8221; tree is pointing to
in the staging area, but adds no new files to <code class="docutils literal"><span class="pre">.git/objects</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ls .git/objects/*/*
.git/objects/00/b54ece7789a75ca80a0edb1e1b1e532a1833d8
.git/objects/23/262403a0b913d02219ead935dd1a85d3724a0d
.git/objects/7c/556d246e95b5cb5b57fbeab8e29686e24225af
.git/objects/9c/0042144fc489d7b528ef186af49e78c2867f91
.git/objects/b6/f9da32793466297a8aeb3d6048c1e96cbd3849
.git/objects/f1/3a8c8331c76ac965c43b09d11ee2d72bb053c1
</pre></div>
</div>
<p>Adding the subproject to the staging area does not make any new objects in
<code class="docutils literal"><span class="pre">.git/objects</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git add subproject
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ls .git/objects/*/*
.git/objects/00/b54ece7789a75ca80a0edb1e1b1e532a1833d8
.git/objects/23/262403a0b913d02219ead935dd1a85d3724a0d
.git/objects/7c/556d246e95b5cb5b57fbeab8e29686e24225af
.git/objects/9c/0042144fc489d7b528ef186af49e78c2867f91
.git/objects/b6/f9da32793466297a8aeb3d6048c1e96cbd3849
.git/objects/f1/3a8c8331c76ac965c43b09d11ee2d72bb053c1
</pre></div>
</div>
<p>So <code class="docutils literal"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">subproject</span></code> makes no new objects, but it does change the
&#8220;myproject&#8221; commit hash that <code class="docutils literal"><span class="pre">subproject</span></code> points to.</p>
<p>If we do the commit, we can see the root tree listing now points
<code class="docutils literal"><span class="pre">subproject</span></code> to the new commit of &#8220;myproject&#8221;:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git commit -m <span class="s2">&quot;Update myproject with more data&quot;</span>
<span class="o">[</span>master 3379d64<span class="o">]</span> Update myproject with more data
 <span class="m">1</span> file changed, <span class="m">1</span> insertion<span class="o">(</span>+<span class="o">)</span>, <span class="m">1</span> deletion<span class="o">(</span>-<span class="o">)</span>
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git ls-tree master
<span class="m">100644</span> blob 00b54ece7789a75ca80a0edb1e1b1e532a1833d8	.gitmodules
<span class="m">100644</span> blob 9c0042144fc489d7b528ef186af49e78c2867f91	README.txt
<span class="m">160000</span> commit 43c26bf6df6a4efade8082f3a5473b807d07c161	subproject
</pre></div>
</div>
</div>
<div class="section" id="cloning-a-repository-with-submodules">
<h3>Cloning a repository with submodules<a class="headerlink" href="#cloning-a-repository-with-submodules" title="Permalink to this headline">¶</a></h3>
<p>What happens if we clone the &#8220;super&#8221; project?</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ..
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="c1"># In directory below &quot;super&quot;</span>
$ git clone super super-cloned
Cloning into <span class="s1">&#39;super-cloned&#39;</span>...
<span class="k">done</span>.
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> super-cloned
$ ls
README.txt
subproject
</pre></div>
</div>
<p>What is in the new <code class="docutils literal"><span class="pre">subproject</span></code> directory?</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ tree -a subproject
subproject

<span class="m">0</span> directories, <span class="m">0</span> files
</pre></div>
</div>
<p>Nothing.  When you <code class="docutils literal"><span class="pre">git</span> <span class="pre">clone</span></code> a project with submodules, git does not clone
the submodules.</p>
<p>Getting the submodule repository clone takes two steps.  These are:</p>
<ul class="simple">
<li>initialize with <code class="docutils literal"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">init</span></code>;</li>
<li>clone with <code class="docutils literal"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">update</span></code>.</li>
</ul>
<p>Initializing the submodule copies the repository submodule information in
<code class="docutils literal"><span class="pre">.gitmodules</span></code> to the repository <code class="docutils literal"><span class="pre">.git/config</span></code> file.  Having this as a
separate step is useful when you want to use a different clone URL from the
one recorded in <code class="docutils literal"><span class="pre">.gitmodules</span></code>. This might happen if you want to use a local
repository to clone from instead of a slower internet repository.  In this
case, you can do <code class="docutils literal"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">init</span></code>, edit <code class="docutils literal"><span class="pre">.git/config</span></code>, and then do the
cloning with <code class="docutils literal"><span class="pre">git</span> <span class="pre">submdoule</span> <span class="pre">update</span></code>.</p>
<p>Here&#8217;s <code class="docutils literal"><span class="pre">.git/config</span></code> before the <code class="docutils literal"><span class="pre">init</span></code> step:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="c1"># .git/config before submodule init</span>
$ cat .git/config
<span class="o">[</span>core<span class="o">]</span>
	<span class="nv">repositoryformatversion</span> <span class="o">=</span> 0
	<span class="nv">filemode</span> <span class="o">=</span> <span class="nb">true</span>
	<span class="nv">bare</span> <span class="o">=</span> <span class="nb">false</span>
	<span class="nv">logallrefupdates</span> <span class="o">=</span> <span class="nb">true</span>
	<span class="nv">ignorecase</span> <span class="o">=</span> <span class="nb">true</span>
	<span class="nv">precomposeunicode</span> <span class="o">=</span> <span class="nb">true</span>
<span class="o">[</span>remote <span class="s2">&quot;origin&quot;</span><span class="o">]</span>
	<span class="nv">url</span> <span class="o">=</span> /Users/mb312/dev_trees/curious-git/working/super
	<span class="nv">fetch</span> <span class="o">=</span> +refs/heads/*:refs/remotes/origin/*
<span class="o">[</span>branch <span class="s2">&quot;master&quot;</span><span class="o">]</span>
	<span class="nv">remote</span> <span class="o">=</span> origin
	<span class="nv">merge</span> <span class="o">=</span> refs/heads/master
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git submodule init
Submodule <span class="s1">&#39;subproject&#39;</span> <span class="o">(</span>/Users/mb312/dev_trees/curious-git/working/myproject<span class="o">)</span> registered <span class="k">for</span> path <span class="s1">&#39;subproject&#39;</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">.git/config</span></code> after the <code class="docutils literal"><span class="pre">init</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="c1"># .git/config after submodule init</span>
$ cat .git/config
<span class="o">[</span>core<span class="o">]</span>
	<span class="nv">repositoryformatversion</span> <span class="o">=</span> 0
	<span class="nv">filemode</span> <span class="o">=</span> <span class="nb">true</span>
	<span class="nv">bare</span> <span class="o">=</span> <span class="nb">false</span>
	<span class="nv">logallrefupdates</span> <span class="o">=</span> <span class="nb">true</span>
	<span class="nv">ignorecase</span> <span class="o">=</span> <span class="nb">true</span>
	<span class="nv">precomposeunicode</span> <span class="o">=</span> <span class="nb">true</span>
<span class="o">[</span>remote <span class="s2">&quot;origin&quot;</span><span class="o">]</span>
	<span class="nv">url</span> <span class="o">=</span> /Users/mb312/dev_trees/curious-git/working/super
	<span class="nv">fetch</span> <span class="o">=</span> +refs/heads/*:refs/remotes/origin/*
<span class="o">[</span>branch <span class="s2">&quot;master&quot;</span><span class="o">]</span>
	<span class="nv">remote</span> <span class="o">=</span> origin
	<span class="nv">merge</span> <span class="o">=</span> refs/heads/master
<span class="o">[</span>submodule <span class="s2">&quot;subproject&quot;</span><span class="o">]</span>
	<span class="nv">url</span> <span class="o">=</span> /Users/mb312/dev_trees/curious-git/working/myproject
</pre></div>
</div>
<p>We have done <code class="docutils literal"><span class="pre">init</span></code>, but not <code class="docutils literal"><span class="pre">update</span></code>. The submodule directory is still
empty:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ tree -a subproject
subproject

<span class="m">0</span> directories, <span class="m">0</span> files
</pre></div>
</div>
<p>To do the submodule clone, use <code class="docutils literal"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">update</span></code> after <code class="docutils literal"><span class="pre">git</span> <span class="pre">submodule</span>
<span class="pre">init</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git submodule update
Submodule path <span class="s1">&#39;subproject&#39;</span>: checked out <span class="s1">&#39;43c26bf6df6a4efade8082f3a5473b807d07c161&#39;</span>
Cloning into <span class="s1">&#39;subproject&#39;</span>...
<span class="k">done</span>.
</pre></div>
</div>
<p>If you are happy to clone from the clone URL recorded in <code class="docutils literal"><span class="pre">.gitmodules</span></code>, then
you can do both <code class="docutils literal"><span class="pre">init</span></code> and <code class="docutils literal"><span class="pre">update</span></code> in one step with:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git submodule update --init
</pre></div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2012-2016 - Matthew Brett.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>