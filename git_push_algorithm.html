<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>An algorithm for git push &#8212; Curious git</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-sphinx.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Reading git objects" href="reading_git_objects.html" />
    <link rel="prev" title="Types of git objects" href="git_object_types.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.12.4.min.js "></script>
<script type="text/javascript" src="_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="_static/bootstrap-3.4.1/js/bootstrap.min.js "></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          Curious git</a>
        <span class="navbar-text navbar-version pull-left"><b>0.2</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="curious_intro.html">Learn git right for a long and happy life</a></li>
<li class="toctree-l1"><a class="reference internal" href="curious_journey.html">A curious tale</a></li>
<li class="toctree-l1"><a class="reference internal" href="curious_git.html">Curious git</a></li>
<li class="toctree-l1"><a class="reference internal" href="curious_remotes.html">git remotes - working with other people, making backups</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="curious_details.html">Deeper inside git</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="curious_git.html">Curious git</a></li>
<li class="toctree-l1"><a class="reference internal" href="README.html">Curious git</a></li>
<li class="toctree-l1"><a class="reference internal" href="np-versions/README.html">np-versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="pdf_contents.html">The curious coder’s guide to git</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">An algorithm for git push</a><ul>
<li><a class="reference internal" href="#paths-through-commits">Paths through commits</a></li>
<li><a class="reference internal" href="#an-algorithm">An algorithm</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="git_object_types.html" title="Previous Chapter: Types of git objects"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Types of git objects</span>
    </a>
  </li>
  <li>
    <a href="reading_git_objects.html" title="Next Chapter: Reading git objects"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Reading git objects &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/git_push_algorithm.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="an-algorithm-for-git-push">
<h1>An algorithm for git push<a class="headerlink" href="#an-algorithm-for-git-push" title="Permalink to this headline">¶</a></h1>
<p>We saw how git stores its object in <a class="reference internal" href="curious_git.html"><span class="doc">Curious git</span></a>.</p>
<p>Now we know about how git stores its objects, we can work out how git knows
which objects to copy when it does a push.</p>
<section id="paths-through-commits">
<h2>Paths through commits<a class="headerlink" href="#paths-through-commits" title="Permalink to this headline">¶</a></h2>
<p>Git commits form a graph.  The commits are the <em>nodes</em> in the graph.  Each
commit (except the first) has one or more parents, stored as hash references
in the commit object. The references to commit parents are the links
between nodes that form the <em>edges</em> in the graph.</p>
<p>If we start at a particular commit, and then track back following only one
parent for each commit, this is a <em>path</em> in the <em>commit history</em>.</p>
</section>
<section id="an-algorithm">
<h2>An algorithm<a class="headerlink" href="#an-algorithm" title="Permalink to this headline">¶</a></h2>
<p>Something like this algorithm might do the job:</p>
<ol class="arabic simple">
<li><p>Get the commit hash corresponding the branch we are going to push;</p></li>
<li><p>Follow every commit path (see above)back from this commit, until we hit a
commit hash (filename) that the remote has.  All the previous commits on
the path, that the remote does not have, are <em>missing commits</em>;</p></li>
<li><p>For every <em>missing commit</em> get the corresponding tree (directory listing)
object.  If the tree object is not in the remote objects directory, add to
the list of <em>missing trees</em>;</p></li>
<li><p>For every <em>missing tree</em> read the tree directory listing. Find any blob
(file) objects in the directory listing that are not in the remote objects
directory, add to the list of <em>missing blob</em> objects <a class="footnote-reference brackets" href="#sub-trees" id="id1">1</a>;</p></li>
<li><p>Copy all <em>missing commit</em>, <em>missing tree</em> and <em>missing blob</em> objects to the
remote objects directory;</p></li>
<li><p>Update the remote branch to point to the same commit as the local branch;</p></li>
<li><p>Update the local record of the last known position of the remote branch to
point to the same commit.</p></li>
</ol>
<p>There’s a specific example of <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span></code> at <a class="reference internal" href="curious_remotes.html#git-push"><span class="std std-ref">git push – synchronizing repositories</span></a>. Here is how
that example would follow our algorithm:</p>
<ol class="arabic simple">
<li><p>We look up the hash for <code class="docutils literal notranslate"><span class="pre">main</span></code>, and we get <code class="docutils literal notranslate"><span class="pre">7919d37dda9044f00cf2dc0677eed18156f75404</span></code> (abbreviated as
<code class="docutils literal notranslate"><span class="pre">7919d37</span></code>);</p></li>
<li><p>We follow all commit history paths back from <code class="docutils literal notranslate"><span class="pre">7919d37</span></code> to
check for missing commits. We start with <code class="docutils literal notranslate"><span class="pre">7919d37</span></code>. The remote
does not have a matching file in <code class="docutils literal notranslate"><span class="pre">objects</span></code>, so this is a missing commit.
We only have one path to follow, because <code class="docutils literal notranslate"><span class="pre">7919d37</span></code> has only
one parent – <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">remote-commit1-sha</span> <span class="pre">}}</span></code> – and the remote does have a
corresponding object, so we can stop looking for missing commits;</p></li>
<li><p>We only have one missing commit, <code class="docutils literal notranslate"><span class="pre">7919d37</span></code>.  We look in the
contents of <code class="docutils literal notranslate"><span class="pre">7919d37</span></code> to find the tree object hash.  This is
<code class="docutils literal notranslate"><span class="pre">2ce031cc4219d31835831f064a6a2d4fb0497c53</span></code>.  We check for this object in the remote objects directory, and
sure enough, it is missing. We add this tree to the list of missing trees;</p></li>
<li><p>We only have one missing tree – <code class="docutils literal notranslate"><span class="pre">2ce031cc4219d31835831f064a6a2d4fb0497c53</span></code>. We look in the contents of
this tree object and check in the remote object directory for each object
in this listing. The only missing object is <code class="docutils literal notranslate"><span class="pre">3ef5df2f711c919685f2063f24d0a18bab17760a</span></code>;</p></li>
<li><p>We copy the objects for the missing commits (<code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">remote-commit1-sha</span> <span class="pre">}}</span></code>), missing trees
(<code class="docutils literal notranslate"><span class="pre">2ce031cc4219d31835831f064a6a2d4fb0497c53</span></code>) and missing blobs (<code class="docutils literal notranslate"><span class="pre">3ef5df2f711c919685f2063f24d0a18bab17760a</span></code>) to the remote objects
directory;</p></li>
<li><p>We set remote <code class="docutils literal notranslate"><span class="pre">refs/heads/main</span></code> to contain the hash
<code class="docutils literal notranslate"><span class="pre">7919d37</span></code>;</p></li>
<li><p>Set the local <code class="docutils literal notranslate"><span class="pre">refs/remotes/usb_backup/main</span></code> to contain
<code class="docutils literal notranslate"><span class="pre">7919d37</span></code>.</p></li>
</ol>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="sub-trees"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>You have probably worked out by now that git directory
listings can have files (called “blobs”) and subdirectories (“trees”) (see
<a class="reference internal" href="git_object_types.html"><span class="doc">Types of git objects</span></a>).  When doing the copy, we actually have to recurse
into any sub-directories to get needed file (“blob”) and subdirectory
(“tree”) objects.  But, you get the idea.</p>
</dd>
</dl>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2012-2016 - Matthew Brett.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.2.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>